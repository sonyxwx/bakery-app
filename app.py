import streamlit as st
import pandas as pd
from datetime import datetime

st.set_page_config(page_title="–ö–æ–Ω–¥–∏—Ç–µ—Ä—Å–∫–∞—è –£—á–µ—Ç", layout="centered")
st.title("üç∞ –°–∏—Å—Ç–µ–º–∞ –∑–∞–∫–∞–∑–æ–≤")

# –¢–≤–æ—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É
SHEET_URL = "https://docs.google.com/spreadsheets/d/1esisqKI9bcqwo7ZtSNKmBMx9hY5RsPgiWO_ThRH250M/export?format=csv&gid=0"

# 1. –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (—á–µ—Ä–µ–∑ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –Ω–∞ CSV)
try:
    # gid=0 ‚Äî —ç—Ç–æ –æ–±—ã—á–Ω–æ –ø–µ—Ä–≤—ã–π –ª–∏—Å—Ç (Inventory)
    inventory = pd.read_csv(SHEET_URL)
    st.success("–î–∞–Ω–Ω—ã–µ —Å–∫–ª–∞–¥–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!")
except Exception as e:
    st.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É")
    st.write("–£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–µ –æ—Ç–∫—Ä—ã—Ç –¥–æ—Å—Ç—É–ø: '–í—Å–µ, —É –∫–æ–≥–æ –µ—Å—Ç—å —Å—Å—ã–ª–∫–∞ ‚Äî –ß–∏—Ç–∞—Ç–µ–ª—å (–∏–ª–∏ –†–µ–¥–∞–∫—Ç–æ—Ä)'")
    st.stop()

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–æ–Ω–æ–∫ (–≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã –Ω–∞–∑–≤–∞–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ –±—ã–ª–∏ –¢–û–ß–ù–û —Ç–∞–∫–∏–º–∏)
if "–ù–∞–∑–≤–∞–Ω–∏–µ" not in inventory.columns:
    st.error(f"–í —Ç–∞–±–ª–∏—Ü–µ –Ω–µ—Ç –∫–æ–ª–æ–Ω–∫–∏ '–ù–∞–∑–≤–∞–Ω–∏–µ'. –Ø –≤–∏–∂—É: {list(inventory.columns)}")
    st.stop()

# 3. –§–æ—Ä–º–∞
with st.form("order_form"):
    dessert = st.selectbox("–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ—Å–µ—Ä—Ç", inventory["–ù–∞–∑–≤–∞–Ω–∏–µ"].tolist())
    leftover = st.number_input("–°–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å (—à—Ç)", min_value=0, step=1)
    submit = st.form_submit_button("–†–∞—Å—Å—á–∏—Ç–∞—Ç—å")

if submit:
    target = inventory.loc[inventory["–ù–∞–∑–≤–∞–Ω–∏–µ"] == dessert, "–ù–æ—Ä–º–∞_–∑–∞–ø–∞—Å–∞"].values[0]
    to_order = int(target - leftover) if target > leftover else 0
    
    st.info(f"–ù—É–∂–Ω–æ –∑–∞–∫–∞–∑–∞—Ç—å: {to_order} —à—Ç.")
    
    # –ß—Ç–æ–±—ã –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞—Ç–Ω–æ –≤ Google –¢–∞–±–ª–∏—Ü—É —á–µ—Ä–µ–∑ —ç—Ç–æ—Ç –º–µ—Ç–æ–¥, 
    # –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å st.write –∏–ª–∏ –≤—ã–≤–æ–¥–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è.
    st.warning("–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–ø–∏—Å–∏ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å API, –Ω–æ –¥–ª—è –Ω–∞—á–∞–ª–∞ –¥–∞–≤–∞–π –¥–æ–±—å–µ–º—Å—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö!")
